{"version":3,"sources":["assets\\Script\\PlayerControl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ExperienceSystem from './ExperienceSystem'; // Import the ExperienceSystem class\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport class PlayerController extends cc.Component {\r\n\r\n    @property()\r\n    playerSpeed: number = 300;\r\n\r\n    @property(cc.Prefab)\r\n    newAttackPrefab: cc.Prefab = null;\r\n\r\n    private moveDir: cc.Vec2 = cc.v2(0, 0);\r\n    private upDown: boolean = false;\r\n    private downDown: boolean = false;\r\n    private leftDown: boolean = false;\r\n    private rightDown: boolean = false;\r\n    private physicManager: cc.PhysicsManager = null;\r\n    private idleFrame: cc.SpriteFrame = null;\r\n    private anim: cc.Animation = null;\r\n    private experienceSystem: ExperienceSystem = null;\r\n\r\n    onLoad() {\r\n        this.physicManager = cc.director.getPhysicsManager();\r\n        this.physicManager.enabled = true;\r\n        this.physicManager.gravity = cc.v2(0, -200);\r\n\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n\r\n        // 获取 ExperienceSystem 组件\r\n        this.experienceSystem = cc.find(\"Canvas/ExperienceBar\").getComponent(ExperienceSystem);\r\n        if (this.experienceSystem) {\r\n            cc.log('ExperienceSystem component found');\r\n            // 绑定 level-up 事件\r\n            this.experienceSystem.node.on('level-up', this.onLevelUp, this);\r\n        } else {\r\n            cc.error('ExperienceSystem component not found');\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.idleFrame = this.getComponent(cc.Sprite).spriteFrame;\r\n        this.anim = this.node.getComponent(cc.Animation);\r\n    }\r\n\r\n    update(dt: number) {\r\n        this.node.x += this.playerSpeed * this.moveDir.x * dt;\r\n        this.node.y += this.playerSpeed * this.moveDir.y * dt;\r\n        if (this.moveDir.x !== 0) {\r\n            this.node.scaleX = (this.moveDir.x >= 0) ? 1 : -1;\r\n        }\r\n    }\r\n\r\n    onKeyDown(event: cc.Event.EventKeyboard) {\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                this.leftDown = true;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.d:\r\n                this.rightDown = true;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.w:\r\n                this.upDown = true;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.s:\r\n                this.downDown = true;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.e:\r\n                if (this.experienceSystem) {\r\n                    this.experienceSystem.addExperience(10); // 按下 E 键增加经验值\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp(event: cc.Event.EventKeyboard) {\r\n        switch (event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                this.leftDown = false;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.d:\r\n                this.rightDown = false;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.w:\r\n                this.upDown = false;\r\n                this.updateMoveDir();\r\n                break;\r\n            case cc.macro.KEY.s:\r\n                this.downDown = false;\r\n                this.updateMoveDir();\r\n                break;\r\n        }\r\n    }\r\n\r\n    private updateMoveDir() {\r\n        this.moveDir.x = 0;\r\n        this.moveDir.y = 0;\r\n        if (this.leftDown) {\r\n            this.moveDir.x -= 1;\r\n        }\r\n        if (this.rightDown) {\r\n            this.moveDir.x += 1;\r\n        }\r\n        if (this.upDown) {\r\n            this.moveDir.y += 1;\r\n        }\r\n        if (this.downDown) {\r\n            this.moveDir.y -= 1;\r\n        }\r\n        this.moveDir.normalizeSelf();\r\n    }\r\n\r\n    private onLevelUp(level: number) {\r\n        cc.log('Player leveled up to level:', level);\r\n        this.spawnNewAttack();\r\n    }\r\n\r\n    private spawnNewAttack() {\r\n        if (this.newAttackPrefab) {\r\n            const newAttack = cc.instantiate(this.newAttackPrefab);\r\n            newAttack.setPosition(0, 0); // 确保位置为相对于玩家节点\r\n            this.node.addChild(newAttack, -1); // 添加到玩家节点，并设置zIndex为-1确保在玩家图像下方\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}